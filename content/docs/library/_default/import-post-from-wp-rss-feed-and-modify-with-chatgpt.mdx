---
title: Import post from WordPress RSS feed and update with ChatGPT
description: Create a new post using the data from some WordPress RSS feed, and modify the post content using ChatGPT
order: 0
# referencedTutorialLessonSlugs:
# - 'retrieving-data-from-an-external-api'
# referencedExtensionSlugs:
# - 'field-to-input'
# - 'helper-function-collection'
# - 'http-client'
# - 'multiple-query-execution'
# - 'php-functions-via-schema'
# predefinedPersistedQueryTitleInPlugin: Import post from WordPress RSS feed
---

This query fetches the post data from a WordPress RSS feed (including the title, content and excerpt), rewrites it using ChatGPT, and stores it on the local WordPress site.

If the author with that username exists locally, it uses it, otherwise it replaces it with the one defined via variable `$defaultAuthorUsername`.

Variable `$url` receives the URL of the WordPress single post's RSS feed. It usually is the blog post URL + `"/feed/rss/?withoutcomments=1"`. Eg:

```apacheconf
https://mysite.com/blog/hello-world/feed/rss/?withoutcomments=1
```

To connect to the OpenAI API, you must also provide variables `$openAIAPIKey` with the API key, and `prompt` with the prompt to rewrite the post's content.

```graphql
query GetPostFromRSSFeedAndExportData(
  $url: URL!
) {
  _sendHTTPRequest(input: {
    url: $url,
    method: GET
  }) {
    body
    rssJSON: _strDecodeXMLAsJSON(
      xml: $__body
      alwaysArrayTagNames: [
        "category",
      ],
    )

    # Fields to be imported
    authorUsername: _objectProperty(
      object: $__rssJSON,
      by: {
        path: "rss.channel.item.dc:creator"
      }
    )
      @export(as: "authorUsername")

    # categorySlugs: _objectProperty(
    #   object: $__rssJSON,
    #   by: {
    #     path: "rss.channel.item.category"
    #   }
    # )

    content:  _objectProperty(
      object: $__rssJSON,
      by: {
        path: "rss.channel.item.content:encoded"
      }
    )
      @export(as: "content")

    excerpt:  _objectProperty(
      object: $__rssJSON,
      by: {
        path: "rss.channel.item.description"
      }
    )
      @export(as: "excerpt")

    title:  _objectProperty(
      object: $__rssJSON,
      by: {
        path: "rss.channel.item.title"
      }
    )
      @export(as: "title")
  }
}

query transformContentWithChatGPT(
  $openAIAPIKey: String!
  $prompt: String!
)
  @depends(on: "GetPostFromRSSFeedAndExportData")
{
  openAIResponse: _sendJSONObjectItemHTTPRequest(input: {
    url: "https://api.openai.com/v1/chat/completions",
    method: POST,
    options: {
      auth: {
        password: $openAIAPIKey
      },
      json: {
        prompt: $prompt
      }
    }
  })
    @underJSONObjectProperty(by: { key: "data" })
      @underArrayItem(index: 0)
        @underJSONObjectProperty(by: { key: "url" })
          @export(as: "generatedImageURL")
}

# If the author's username exists in this site, keep it
# Otherwise, use the default one
query CheckAuthorExistsOrChange(
  $defaultAuthorUsername: String! = "admin"
)
  @depends(on: "transformContentWithChatGPT")
{
  existingUserByUsername: user(by: { username: $authorUsername })
  {
    id
    username
  }
  userExists: _notNull(value: $__existingUserByUsername)
  username: _if(
    condition: $__userExists,
    then: $authorUsername,
    else: $defaultAuthorUsername
  )
    @export(as: "existingAuthorUsername")
}

mutation ImportPostFromWPRSSFeed
  @depends(on: "CheckAuthorExistsOrChange")
{
  createPost(input: {
    status: draft,
    authorBy: {
      username: $existingAuthorUsername
    },
    contentAs: {
      html: $content
    },
    excerpt: $excerpt
    title: $title
  }) {
    status
    errors {
      __typename
      ...on ErrorPayload {
        message
      }
    }
    post {
      id
      slug
      date
      status

      author {
        id
        username
      }
      content
      excerpt
      title
    }
  }
}
```
